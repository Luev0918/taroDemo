"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[352],{4025:function(e,t,n){var r=n(7036),i=n(7904),o=n(9501),a=n(8037),l=n(1517),s=n(5234),u=n(2484),c=n(5271),d=n(8966),p=n(7146),f=n(2247),h=n(1738),x=n(6553),v=n.n(x),m=n(2676),g=function(){var e=(0,p.CG)((function(e){return e.user.userInfo.nickname})),t=(0,p.CG)((function(e){return e.user.userInfo.pkId})),n=(0,p.TL)(),r=(0,c.useState)({tagList:[],panList:[],resourceList:[]}),g=(0,s.Z)(r,2),Z=g[0],w=g[1],y=(0,c.useState)({title:"",isTop:1,downloadUrl:"",price:0,detail:"",tags:[],diskType:null,resType:[]}),T=(0,s.Z)(y,2),k=T[0],j=T[1],L=(0,c.useState)(!1),b=(0,s.Z)(L,2),U=b[0],C=b[1],S=(0,c.useState)(!1),I=(0,s.Z)(S,2),A=I[0],G=I[1],J=(0,c.useState)(null),N=(0,s.Z)(J,2),$=N[0],q=N[1],B=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,f.fz)();case 2:t=e.sent,0===t.code&&(t.data.forEach((function(e){e.inverted=!1})),w((function(e){return(0,a.Z)((0,a.Z)({},e),{},{tagList:t.data})})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){var t,n;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,(0,f.AT)();case 2:t=e.sent,console.log("\u6253\u5370\u4e00\u4e0b",t),0===t.code&&(n=t.data.filter((function(e){return 1===e.type})).map((function(e){return e.inverted=!1,e})),w((function(e){return(0,a.Z)((0,a.Z)({},e),{},{panList:t.data.filter((function(e){return 0===e.type})),resourceList:n})})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,x.useLoad)((function(){t?Promise.all([B(),F()]):(v().showToast({title:"\u8bf7\u5148\u767b\u5f55",icon:"none"}),n((0,h.wp)({})),setTimeout((function(){v().navigateTo({url:"/pages/login/login"})}),1e3))}));var O=function(){var e=(0,l.Z)((0,o.Z)().mark((function e(){var t;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(k.title&&k.downloadUrl&&k.price){e.next=2;break}return e.abrupt("return",v().showToast({title:"\u8bf7\u586b\u5199\u5b8c\u6574\u4fe1\u606f",icon:"none"}));case 2:return e.next=4,(0,f.id)(k);case 4:t=e.sent,0===t.code?(v().showToast({title:"\u6295\u7a3f\u6210\u529f",icon:"success"}),P()):v().showToast({title:"\u6295\u7a3f\u5931\u8d25",icon:"none"}),console.log(k);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),P=function(){j({title:"",isTop:1,downloadUrl:"",price:0,detail:"",tags:[],diskType:null,resType:[]}),q(null),w((function(e){return(0,a.Z)((0,a.Z)({},e),{},{resourceList:e.resourceList.map((function(e){return e.inverted=!1,e})),tagList:e.tagList.map((function(e){return e.inverted=!1,e}))})}))},z=function(e){console.log("contributeForm.downloadUrl",k.downloadUrl),j((0,a.Z)((0,a.Z)({},k),{},{downloadUrl:e}));var t=/^(https?|ftp):\/\/[^\s/$.?#].[^\s]*$/;if(t.test(k.downloadUrl)&&""!==k.downloadUrl){console.log("\u6253\u5370\u7f51\u76d8\u7c7b\u578b1",k),console.log("\u6253\u5370\u7f51\u76d8\u7c7b\u578b2",Z);var n=E(k.downloadUrl,Z.panList);n||(n=Z.panList.find((function(e){return"\u5176\u4ed6\u7f51\u76d8"===e.title}))),q(n),j((function(e){return(0,a.Z)((0,a.Z)({},e),{},{diskType:n.pkId||0})}))}else v().showToast({title:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u94fe\u63a5",icon:"none"})},E=function(e,t){return console.log(e,t,"find"),t.find((function(t){return e.includes(t.description)}))},Q=function(e){D(e,"resType"),console.log(e)},R=function(e){D(e,"tags"),console.log(e)},D=function(e,t){var n="tags"===t?k.tags:k.resType,r=3;if(n.length>=r&&!e.inverted)v().showToast({title:"\u6700\u591a\u9009\u62e93\u4e2a\u6807\u7b7e",icon:"none"});else{e.inverted=!e.inverted;var o=e.pkId;if(e.inverted)n.push(o);else{var l=n.findIndex((function(e){return e===o}));n.splice(l,1)}j((function(e){return(0,a.Z)((0,a.Z)({},e),{},(0,i.Z)({},t,n))}))}};return(0,m.jsx)(m.Fragment,{children:(0,m.jsxs)(u.G7,{className:"contribute",children:[(0,m.jsxs)(d.Qi,{onSubmit:O,children:[(0,m.jsx)(d.A9,{name:"value",title:"\u7528\u6237\u6635\u79f0",type:"text",placeholder:"\u8bf7\u8f93\u5165\u7528\u6237\u6635\u79f0",value:e,disabled:!0}),(0,m.jsx)(d.A9,{name:"title",title:"\u6807\u9898",type:"text",required:!0,placeholder:"\u8bf7\u8f93\u5165\u6807\u9898",value:k.title,onChange:function(e){return j((0,a.Z)((0,a.Z)({},k),{},{title:e+""}))}}),(0,m.jsx)(d.j4,{title:"\u662f\u5426\u7f6e\u9876",checked:1===k.isTop,onChange:function(e){return j((0,a.Z)((0,a.Z)({},k),{},{isTop:!0===e?1:0}))}}),(0,m.jsx)(d.A9,{name:"value",title:"\u4e0b\u8f7d\u94fe\u63a5",type:"text",required:!0,placeholder:"\u8bf7\u8f93\u5165\u4e0b\u8f7d\u94fe\u63a5",value:k.downloadUrl,onChange:function(e){return z(e)}}),(0,m.jsx)(d.A9,{name:"value",title:"\u7f51\u76d8\u7c7b\u578b",type:"text",disabled:!0,placeholder:"\u8bf7\u8f93\u5165\u7f51\u76d8\u7c7b\u578b",value:null===$?"\u8bf7\u9009\u62e9\u7f51\u76d8\u7c7b\u578b":null===$||void 0===$?void 0:$.title}),(0,m.jsx)(d.A9,{name:"price",title:"\u79ef\u5206",type:"number",required:!0,placeholder:"\u8bf7\u8f93\u5165\u79ef\u5206",value:k.price+"",onChange:function(e){return j((0,a.Z)((0,a.Z)({},k),{},{price:+e}))}}),(0,m.jsxs)(u.G7,{className:"detail-box",children:[(0,m.jsx)(u.G7,{className:"detail-text",children:"\u8d44\u6e90\u63cf\u8ff0"}),(0,m.jsx)(d.eA,{className:"detail-textarea",placeholder:"\u8bf7\u8f93\u5165\u8be6\u7ec6\u63cf\u8ff0",maxLength:200,value:k.detail,onChange:function(e){return j((0,a.Z)((0,a.Z)({},k),{},{detail:e+""}))}})]}),(0,m.jsx)(d.l$,{open:U,onClick:function(){return C(!U)},title:"\u6807\u7b7e",children:(0,m.jsx)(d.iJ,{hasBorder:!0,children:Z.tagList.map((function(e){return(0,m.jsx)(d.iU,{name:e.title,active:e.inverted,customStyle:{margin:"5px 2px 10px 0"},onClick:function(){return R(e)},children:e.title},e.pkId)}))})}),(0,m.jsx)(d.l$,{open:A,onClick:function(){return G(!A)},title:"\u8d44\u6e90\u7c7b\u578b",children:(0,m.jsx)(d.iJ,{hasBorder:!0,children:Z.resourceList.map((function(e){return(0,m.jsx)(d.iU,{name:e.title,active:e.inverted,customStyle:{margin:"5px 2px 10px 0"},circle:!0,type:"primary",onClick:function(){return Q(e)},children:e.title},e.pkId)}))})})]}),(0,m.jsx)(d.mU,{formType:"submit",circle:!0,type:"primary",customStyle:{marginTop:"20px"},onClick:O,children:"\u63d0\u4ea4"})]})})},Z=g,w={navigationBarTitleText:"\u6295\u7a3f\u2eda\u9762"};Page((0,r.R4)(Z,"pages/contribute/contribute",{root:{cn:[]}},w||{}))}},function(e){var t=function(t){return e(e.s=t)};e.O(0,[107,216,592],(function(){return t(4025)}));e.O()}]);