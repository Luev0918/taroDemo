"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[329],{5308:function(e,n,t){var s=t(7036),a=t(8037),r=t(5234),c=t(9501),o=t(1517),i=t(5271),u=t(6553),l=t.n(u),p=t(7146),h=t(1738),d=t(5433),x=t(5834),f=t(2484),v=t(2676),w=function(){var e=(0,p.TL)(),n=function(){var n=(0,o.Z)((0,c.Z)().mark((function n(){var t;return(0,c.Z)().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return n.next=2,(0,x.bG)();case 2:t=n.sent,0===t.code?e((0,h.ps)(t.data)):l().showToast({title:t.msg,icon:"none"});case 4:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),t=(0,i.useState)(60),s=(0,r.Z)(t,2),u=s[0],w=s[1],m=(0,i.useState)(!1),k=(0,r.Z)(m,2),g=k[0],Z=k[1],b=(0,i.useState)({phone:"",code:""}),j=(0,r.Z)(b,2),T=j[0],N=j[1];(0,i.useEffect)((function(){var e;return g&&(e=setInterval((function(){w((function(n){return 1===n?(clearInterval(e),Z(!1),60):n-1}))}),1e3)),function(){return clearInterval(e)}}),[g]);var G=function(){var e=(0,o.Z)((0,c.Z)().mark((function e(){var n;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!T.phone||!(0,d.J)(T.phone)){e.next=8;break}return Z(!0),e.next=4,(0,x.Z3)(T.phone);case 4:n=e.sent,0===n.code?l().showToast({title:"\u9a8c\u8bc1\u7801\u53d1\u9001\u6210\u529f",icon:"none"}):l().showToast({title:"\u53d1\u9001\u9a8c\u8bc1\u7801\u5931\u8d25",icon:"none"}),e.next=9;break;case 8:l().showToast({title:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7",icon:"none"});case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),y=function(){var e=l().getCurrentPages();e.length>1?l().navigateBack():l().switchTab({url:"/pages/index/index"})},I=function(){var e=(0,o.Z)((0,c.Z)().mark((function e(){var t;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(T.phone&&(0,d.J)(T.phone)){e.next=3;break}return l().showToast({title:"\u8bf7\u8f93\u5165\u6b63\u786e\u7684\u624b\u673a\u53f7\u7801",icon:"none"}),e.abrupt("return");case 3:if(T.code&&(0,d.L)(T.code)){e.next=6;break}return l().showToast({title:"\u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801\u6b63\u786e\u7684\u9a8c\u8bc1\u7801",icon:"none"}),e.abrupt("return");case 6:return e.next=8,(0,x.Vj)(T.phone,T.code);case 8:if(t=e.sent,0!==t.code){e.next=16;break}l().setStorageSync("token",t.data.accessToken),n(),l().showToast({title:"\u767b\u9646\u6210\u529f",icon:"success"}),y(),e.next=18;break;case 16:return l().showToast({title:t.msg,icon:"none"}),e.abrupt("return");case 18:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),S=function(){var e=(0,o.Z)((0,c.Z)().mark((function e(){var t,s,a;return(0,c.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l().getUserProfile({desc:"\u83b7\u53d6\u4f60\u7684\u6635\u79f0\u3001\u5934\u50cf\u3001\u5730\u533a\u53ca\u6027\u522b"});case 3:return t=e.sent,e.next=6,l().login();case 6:if(s=e.sent,console.log(s),!s.code){e.next=13;break}return e.next=11,(0,x.HA)(s.code,t.encryptedData,t.iv);case 11:a=e.sent,0===a.code?(l().showToast({title:"\u767b\u5f55\u6210\u529f",icon:"success"}),l().setStorageSync("token",a.data.accessToken),n(),y()):l().showToast({title:a.msg,icon:"none"});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e["catch"](0),l().showToast({title:"\u83b7\u53d6\u7528\u6237\u4fe1\u606f\u5931\u8d25",icon:"none"});case 18:case"end":return e.stop()}}),e,null,[[0,15]])})));return function(){return e.apply(this,arguments)}}(),C=function(e){N((0,a.Z)((0,a.Z)({},T),{},{code:e.detail.value}))},J=function(e){N((0,a.Z)((0,a.Z)({},T),{},{phone:e.detail.value}))};return(0,v.jsxs)(f.G7,{className:" loginPage ",children:[(0,v.jsxs)(f.G7,{className:"top",children:[(0,v.jsx)(f.G7,{className:"title",children:"\u9a8c\u8bc1\u7801\u767b\u5f55"}),(0,v.jsx)(f.G7,{className:"info",children:"\u672a\u6ce8\u518c\u7684\u624b\u673a\u53f7\u9a8c\u8bc1\u540e\u81ea\u52a8\u5b8c\u6210\u6ce8\u518c"})]}),(0,v.jsxs)(f.G7,{className:"form",children:[(0,v.jsx)(f.II,{className:" input",type:"text",placeholder:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7\u7801",value:T.phone,onInput:function(e){return J(e)}}),(0,v.jsxs)(f.G7,{className:"code",children:[(0,v.jsx)(f.II,{className:"password",type:"text",password:!0,placeholder:" \u8bf7\u8f93\u5165\u9a8c\u8bc1\u7801",value:T.code,onInput:function(e){return C(e)}}),g?(0,v.jsxs)(f.xv,{className:"btn",hidden:!g,children:[u,"\u79d2\u540e\u91cd\u65b0\u83b7\u53d6"]}):(0,v.jsx)(f.xv,{className:"btn",onClick:G,hidden:g,children:"\u83b7\u53d6\u9a8c\u8bc1\u7801"})]}),(0,v.jsx)(f.zx,{className:"button",onClick:I,children:"\u767b\u5f55"}),(0,v.jsxs)(f.G7,{className:"extra",children:[(0,v.jsx)(f.G7,{className:" caption",children:(0,v.jsx)(f.xv,{children:"\u5176\u4ed6\u767b\u5f55\u65b9\u5f0f"})}),(0,v.jsx)(f.G7,{className:"options",children:(0,v.jsx)(f.xv,{className:"icon icon-weixin",onClick:S,children:"\u5fae\u4fe1\u4e00\u952e\u767b\u5f55"})})]}),(0,v.jsx)(f.G7,{className:"tips",children:"\u767b\u5f55/\u6ce8\u518c\u5373\u89c6\u4e3a\u4f60\u540c\u610f\u300a\u670d\u52a1\u6761\u6b3e\u300b\u6025\u79c1\u534f\u8bae\u300b"})]})]})},m=w,k={navigationBarTitleText:"\u767b\u5f55"};Page((0,s.R4)(m,"pages/login/login",{root:{cn:[]}},k||{}))}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[107,216,592],(function(){return n(5308)}));e.O()}]);